# Data Model: seo-analytics

## Overview

This feature is **infrastructure-only** with no persistent data storage. All entities are configuration objects, runtime state, or external system data (GA4, Google Search Console).

---

## Entities

### SEO Configuration
**Purpose**: Site-wide SEO defaults and page-level overrides

**Fields**:
- `title`: string - Page title (50-60 characters, from FR-005)
- `description`: string - Meta description (150-160 characters, from FR-005)
- `canonical`: string - Canonical URL (prevents duplicate content)
- `openGraph`: object - Open Graph meta tags
  - `title`: string
  - `description`: string
  - `url`: string
  - `type`: string (website, article)
  - `images`: array of { url, width, height, alt }
- `twitter`: object - Twitter Card meta tags
  - `handle`: string (@marcusgoll)
  - `site`: string
  - `cardType`: string (summary_large_image)

**Storage**: Not persisted - Configuration object in `lib/seo-config.ts`

**Usage**: Imported by page components, passed to NextSeo component

---

### Sitemap Entry
**Purpose**: Represents a page in the generated sitemap.xml

**Fields**:
- `url`: string - Absolute URL (e.g., https://marcusgoll.com/blog/post-slug)
- `lastModified`: ISO 8601 timestamp - Last update date
- `changeFrequency`: enum - How often page changes (daily, weekly, monthly)
- `priority`: float (0.0-1.0) - Relative importance (homepage: 1.0, blog: 0.9, posts: 0.8)

**Generation Logic**:
- Static pages: Priority 1.0 (homepage), 0.9 (blog index)
- Blog posts: Priority 0.8, lastModified from frontmatter.date
- Excluded: Admin routes, drafts, development pages (from FR-011)

**Storage**: Not persisted - Generated at build time, written to `public/sitemap.xml`

**Source**: `lib/generate-sitemap.ts` (existing)

---

### JSON-LD Schema
**Purpose**: Machine-readable structured data for search engines and LLM crawlers

**Schema Types**:

#### Article Schema (Blog Posts)
**Purpose**: Describe blog post content (from FR-006)

**Fields**:
- `@context`: "https://schema.org"
- `@type`: "Article"
- `headline`: string - Post title (matches meta title)
- `author`: object - Author information
  - `@type`: "Person"
  - `name`: "Marcus Gollahon"
  - `url`: "https://marcusgoll.com"
- `datePublished`: ISO 8601 timestamp
- `dateModified`: ISO 8601 timestamp (if edited)
- `image`: string - Featured image URL (1200×630px OG image)
- `publisher`: object - Site publisher
  - `@type`: "Organization"
  - `name`: "Marcus Gollahon"
  - `logo`: { @type: "ImageObject", url: string }

**Validation**: Must validate against schema.org Article specification (from FR-008)

#### WebSite Schema (Homepage)
**Purpose**: Describe website identity (from FR-007)

**Fields**:
- `@context`: "https://schema.org"
- `@type`: "WebSite"
- `name`: "Marcus Gollahon"
- `url`: "https://marcusgoll.com"
- `description`: "Teaching systematic thinking from 30,000 feet"
- `author`: object (Person)
- `potentialAction`: SearchAction (optional - for search box)

**Storage**: Generated dynamically, embedded in `<script type="application/ld+json">` tags

**Size Limit**: <1KB per page (from NFR-003)

---

### Analytics Event
**Purpose**: Track user actions and page views in Google Analytics 4

**Fields** (common to all events):
- `event_name`: string - Event identifier (page_view, newsletter_view, etc.)
- `page_path`: string - Current URL path
- `content_track`: enum - Content category (aviation, dev-startup, cross-pollination, general)
- `timestamp`: auto-generated by GA4
- `session_id`: auto-generated by GA4
- `user_id`: anonymous (no PII, from NFR-007)

**Event Types**:

1. **page_view** (from FR-014)
   - Automatic GA4 default event
   - Enhanced with `content_track` parameter

2. **newsletter_view** (from FR-016)
   - Fired when newsletter form displayed
   - Parameters: `page_path`, `content_track`

3. **newsletter_submit** (from FR-017)
   - Fired when form submitted
   - Parameters: `page_path`, `content_track`, `source` (page that drove signup)

4. **newsletter_success** (from FR-018)
   - Fired when subscription confirmed
   - Parameters: `page_path`, `content_track`, `source`

5. **content_track_click** (existing)
   - Existing event for dual-track navigation
   - Parameters: `content_track`, `location`

6. **external_link_click** (existing)
   - Existing event for outbound links
   - Parameters: `destination`, `location`

**Storage**: Sent to Google Analytics 4 via gtag.js, not stored locally

**Privacy**: IP anonymization enabled (from NFR-006), no PII in custom events (from NFR-007)

**Error Handling**: Silent failure if GA4 unavailable (from NFR-008)

---

### Robots Directive
**Purpose**: Control crawler access to site content

**Fields**:
- `userAgent`: string - Crawler identifier (Googlebot, GPTBot, ClaudeBot, etc.)
- `allow`: array of strings - Allowed paths (e.g., ["/", "/blog/"])
- `disallow`: array of strings - Disallowed paths (e.g., ["/admin", "/api/"])
- `sitemapUrl`: string - Location of sitemap (from FR-012)

**Storage**: Static file `public/robots.txt`

**User-Agents to Configure** (from FR-012):
- `*` (all crawlers) - Default rules
- `GPTBot` (OpenAI)
- `Google-Extended` (Google Bard/Gemini training data)
- `ClaudeBot` (Anthropic)
- `CCBot` (Common Crawl)

**Format**:
```
User-agent: *
Allow: /
Disallow: /admin
Disallow: /api

User-agent: GPTBot
Allow: /blog/
Disallow: /

Sitemap: https://marcusgoll.com/sitemap.xml
```

---

## State Shape (Frontend)

### SEO Context (No State Management Needed)
SEO configuration is stateless - each page component imports and renders SEO tags.

```typescript
// lib/seo-config.ts
interface SEOConfig {
  title: string;
  description: string;
  canonical: string;
  openGraph: OpenGraphConfig;
  twitter: TwitterConfig;
}

// Usage in page component
import { getPageSEO } from '@/lib/seo-config';

export default function BlogPost({ params }: { params: { slug: string } }) {
  const seo = getPageSEO({
    title: post.frontmatter.title,
    description: post.frontmatter.excerpt,
    canonical: `/blog/${params.slug}`,
    image: post.frontmatter.featured_image,
  });

  return (
    <>
      <NextSeo {...seo} />
      <JsonLd schema={generateArticleSchema(post)} />
      {/* Page content */}
    </>
  );
}
```

### Analytics State (No React State)
Analytics events fire imperatively, no component state required.

```typescript
// Usage in client component
import { trackNewsletterSubmit } from '@/lib/analytics';

function NewsletterForm() {
  const handleSubmit = async (e) => {
    e.preventDefault();
    // Submit to backend
    // ...
    // Track event
    trackNewsletterSubmit({
      location: window.location.pathname,
      track: 'aviation', // or dynamically determined
    });
  };
}
```

---

## Database Schema

**N/A** - No database changes required. This is a client-side infrastructure feature.

---

## API Schemas

**N/A** - No API endpoints modified. Analytics events sent directly to Google Analytics 4 via gtag.js.

**Future consideration**: If implementing server-side event tracking, would require API endpoint accepting `POST /api/analytics/event` with event payload.

---

## Validation Rules

### Meta Tags (from FR-005)
- `title`: 50-60 characters (Google SERP display limit)
- `description`: 150-160 characters (Google SERP snippet length)
- `og:image`: 1200×630px (Facebook recommended size)
- `twitter:card`: "summary_large_image" (optimal preview format)

### JSON-LD (from FR-008)
- Must validate against schema.org specifications
- Use Google Rich Results Test for validation
- Size limit: <1KB per page (from NFR-003)

### Sitemap (from FR-010, FR-011)
- Must include `<lastmod>` timestamps for all entries
- Exclude admin routes, draft posts, development pages
- URLs must be absolute (include protocol and domain)

### Analytics Events (from NFR-007)
- No Personally Identifiable Information (PII) in event parameters
- Event names: lowercase, underscore-separated (GA4 convention)
- Parameters: snake_case naming (GA4 convention)

---

## Performance Considerations

### Meta Tag Injection (from NFR-001)
- next-seo renders meta tags during SSR
- Expected overhead: <5ms per page
- No client-side rendering blocking

### JSON-LD Size (from NFR-003)
- Article schema: ~500-800 bytes
- WebSite schema: ~300-500 bytes
- Total per page: <1KB limit enforced

### Sitemap Generation (from NFR-004)
- Build-time generation via postbuild script
- Expected duration: <30s for 1000 pages
- No runtime performance impact

### GA4 Script Loading (from NFR-002)
- Already implemented asynchronously in `app/layout.tsx`
- Strategy: "afterInteractive" (non-blocking)
- No First Contentful Paint impact

---

## Related Requirements

- **FR-001 to FR-005**: Meta tags (title, description, OG, Twitter)
- **FR-006 to FR-008**: JSON-LD structured data
- **FR-009 to FR-012**: Sitemap and robots.txt
- **FR-013 to FR-015**: Google Analytics 4 core tracking
- **FR-016 to FR-019**: Custom event tracking (newsletter)
- **FR-020 to FR-021**: Semantic HTML5 markup

- **NFR-001 to NFR-004**: Performance targets
- **NFR-005 to NFR-009**: Accessibility, privacy, error handling
